<h2>4. Filter &amp; Density plots comparsion  </h2>
<p>
    In this experiment, we compare density plots produced from different BED files using two distinct approaches.
    The first approach extracts information directly from the BED file via a Bash script.
    The second approach uses Python to read the BED file and construct a cell-by-tile matrix.
</p>
</p>
<p>
    The left image shows a density plot generated by the Bash script, which extracts unique cells from the BED file.
    The right image shows the corresponding density plot produced by the Python script.
    
</p>
<img src="results/verify/bash_Density_plot_pool1_DJ_Hs_CM_0_K4me123_070122.png" width="280" alt="origin">
<img src="results/verify/python_Density_plot_pool1_DJ_Hs_CM_0_K4me123_070122.png" width="280" alt="origin">
<p>
    Here, the left figure was created in Python using ggplot2, and the right figure was generated in R with ggplot2.
</p>
<img src="results/verify/ggplot_python_pool1_DJ_Hs_CM_0_K4me123_070122.png" width="280" alt="origin">
<img src="results/verify/ggplot_R_pool1_DJ_Hs_CM_0_K4me123_070122.png" width="280" alt="origin">
<p>
    The difference in density plots between R and Python is due to the
    chosen bandwidth for calculating the density. Python functions tend
    to use a larger bandwidth, making the curve smoother and obscuring
    local structure, while R’s ggplot2 produces a curve that retains more detail.
</p>

<h3>4.1 The number of cell kept</h3>
<p>
    To track the number of cells retained after filtering for those with at 
    least 300 unique fragments (K4), the example shows 389 cells (pool1), 
    whereas the Python script reports 345 cells (pool1).
</p>
<p>
    This discrepancy occurs because the Python script excludes sub-chromosomal
    data (e.g., chromosomes X and Y) from its count.
</p>
<p><b>In the following experiment, we set a range of threshold: 100, 300, 500.
    There are paired figures that w/(left figure) and w/o (right figure) smooth algorithm. 
</b></p>
<p>
    set the <code>threshold</code> to be <b>100</b>:<br>
    The file information:results/tile_matrix_DJ_Hs_CM_0_K4me123_070122.npz<br>
    [filter] Kept 20646 / 57509 tiles (≥10 reads)<br>
    The information of the tile matrix :(23336, 20646)<br>
    The length of the totla reads:22053<br>
    The max of the reads:12686<br>
    [cell filter] keeping 575 / 22053 cells (reads ≥ 100)<br>
    [drop=0.90] kept 20646/20646 tiles; var_features→2064<br>
    [smooth] building KNN graph (k=15) …<br>
    [smooth] aggregating values …<br>
    [drop=0.90] kept 20646/20646 tiles; var_features→2064
</p>
<img src="results/section4/miniread10_thresdhold100_drop0.9_smooth.png" width="280" alt="origin">
<img src="results/section4/miniread10_thresdhold100_drop0.9_nosmooth.png" width="280" alt="origin">

<p>
    set the <code>threshold</code> to be <b>300</b>:<br>
    The file information:results/tile_matrix_DJ_Hs_CM_0_K4me123_070122.npz<br>
    [filter] Kept 20646 / 57509 tiles (≥10 reads)<br>
    The information of the tile matrix :(23336, 20646)<br>
    The length of the totla reads:22053<br>
    The max of the reads:12686<br>
    [cell filter] keeping 345 / 22053 cells (reads ≥ 300)<br>
    [drop=0.90] kept 20646/20646 tiles; var_features→2064<br>
    [smooth] building KNN graph (k=15) …<br>
    [smooth] aggregating values …<br>
    [drop=0.90] kept 20646/20646 tiles; var_features→2064
</p>
<img src="results/section4/miniread10_thresdhold300_drop0.9_smooth.png" width="280" alt="origin">
<img src="results/section4/miniread10_thresdhold300_drop0.9_nosmooth.png" width="280" alt="origin">

<p>
    Set the <code>threshold</code> to be <b>500</b>:<br>
    The file information:results/tile_matrix_DJ_Hs_CM_0_K4me123_070122.npz<br>
    [filter] Kept 20646 / 57509 tiles (≥10 reads)<br>
    The information of the tile matrix :(23336, 20646)<br>
    The length of the totla reads:22053<br>
    The max of the reads:12686<br>
    [cell filter] keeping 272 / 22053 cells (reads ≥ 500)<br>
    [drop=0.90] kept 20646/20646 tiles; var_features→2064<br>
    [smooth] building KNN graph (k=15) …<br>
    [smooth] aggregating values …<br>
    [drop=0.90] kept 20646/20646 tiles; var_features→2064
</p>
<img src="results/section4/miniread10_thresdhold500_drop0.9_smooth.png" width="280" alt="origin">
<img src="results/section4/miniread10_thresdhold500_drop0.9_nosmooth.png" width="280" alt="origin">


<h3>4.2 read another sample from pool2</h3>
<p>
    We also ran the Python script with different bed files (pool1 and pool2).
    The following figure is the density plot from pool2 (K4).
</p>
<img src="results/section4/verify/python_Density_plot_pool2_DJ_Hs_CM_0_K4me123_070122.png" width="280" alt="origin">
<p>
    set the <code>threshold</code> to be <b>100</b>:<br>
    The file information:results/tile_matrix_pool2_DJ_Hs_CM_0_K4me123_070122.bed.npz<br>
    [filter] Kept 22780 / 57509 tiles (≥10 reads)<br>
    The information of the tile matrix :(23894, 22780)<br>
    The length of the totla reads:22987<br>
    The max of the reads:25720<br>
    [cell filter] keeping 534 / 22987 cells (reads ≥ 100)<br>
    [drop=0.90] kept 20646/22780 tiles; var_features→2064<br>
    [smooth] building KNN graph (k=15) …<br>
    [smooth] aggregating values …<br>
    [drop=0.90] kept 20646/22780 tiles; var_features→2064
</p>
<img src="results/section4/miniread10_thresdhold100_drop0.9_smooth_pool2.png" width="280" alt="origin">
<img src="results/section4/miniread10_thresdhold100_drop0.9_nosmooth_pool2.png" width="280" alt="origin">



<p>
    set the <code>threshold</code> to be <b>300</b>:<br>
    The file information:results/tile_matrix_pool2_DJ_Hs_CM_0_K4me123_070122.bed.npz<br>
    [filter] Kept 22780 / 57509 tiles (≥10 reads)<br>
    The information of the tile matrix :(23894, 22780)<br>
    The length of the totla reads:22987<br>
    The max of the reads:25720<br>
    [cell filter] keeping 305 / 22987 cells (reads ≥ 300)<br>
    [drop=0.90] kept 20646/22780 tiles; var_features→2064<br>
    [smooth] building KNN graph (k=15) …<br>
    [smooth] aggregating values …<br>
    [drop=0.90] kept 20646/22780 tiles; var_features→2064
</p>
<img src="results/section4/miniread10_thresdhold300_drop0.9_smooth_pool2.png" width="280" alt="origin">
<img src="results/section4/miniread10_thresdhold300_drop0.9_nosmooth_pool2.png" width="280" alt="origin">

<p>
    set the <code>threshold</code> to be <b>500</b>:<br>
    The file information:results/tile_matrix_pool2_DJ_Hs_CM_0_K4me123_070122.bed.npz<br>
    [filter] Kept 22780 / 57509 tiles (≥10 reads)<br>
    The information of the tile matrix :(23894, 22780)<br>
    The length of the totla reads:22987<br>
    The max of the reads:25720<br>
    [cell filter] keeping 252 / 22987 cells (reads ≥ 500)<br>
    [drop=0.90] kept 20646/22780 tiles; var_features→2064<br>
    [smooth] building KNN graph (k=15) …<br>
    [smooth] aggregating values …<br>
    [drop=0.90] kept 20646/22780 tiles; var_features→2064<br>
</p>
<img src="results/section4/miniread10_thresdhold500_drop0.9_smooth_pool2.png" width="280" alt="origin">
<img src="results/section4/miniread10_thresdhold500_drop0.9_nosmooth_pool2.png" width="280" alt="origin">

<h3>4.3 concatenate samples from pool1 and pool2</h3>
<p><b>In the following experiment, we contatneate the K4 sample from pool1 and pool2
    to enhance the number of samples
</b></p>
<p>
    set the <code>threshold</code> to be <b>100</b>:<br>
    The file information:['results/tile_matrix_pool2_DJ_Hs_CM_0_K4me123_070122.bed.npz', 'results/tile_matrix_DJ_Hs_CM_0_K4me123_070122.npz']<br>
    [filter] Kept 34320 / 57509 tiles (≥10 reads)<br>
    The information of the tile matrix :(47230, 34320)<br>
    The length of the totla reads:46052<br>
    The max of the reads:28983<br>
    [cell filter] keeping 1205 / 46052 cells (reads ≥ 100)<br>
    [drop=0.90] kept 34320/34320 tiles; var_features→3431<br>
    [smooth] building KNN graph (k=15) …<br>
    [smooth] aggregating values …

</p>
<img src="results/section4/miniread10_thresdhold100_drop0.9_smooth_pool1n2.png" width="280" alt="origin">
<img src="results/section4/miniread10_thresdhold100_drop0.9_nosmooth_pool1n2.png" width="280" alt="origin">

<p>
    set the <code>threshold</code> to be <b>300</b>:
    The file information:['results/tile_matrix_pool2_DJ_Hs_CM_0_K4me123_070122.bed.npz', 'results/tile_matrix_DJ_Hs_CM_0_K4me123_070122.npz']<br>
    [filter] Kept 34320 / 57509 tiles (≥10 reads)<br>
    The information of the tile matrix :(47230, 34320)<br>
    The length of the totla reads:46052<br>
    The max of the reads:28983<br>
    [cell filter]  keeping 685 / 46052 cells (reads ≥ 300)<br>
    [drop=0.90] kept 34320/34320 tiles; var_features→3431<br>
    [smooth] building KNN graph (k=15) …<br>
    [smooth] aggregating values …<br>
    [drop=0.90] kept 34320/34320 tiles; var_features→3431
</p>
<img src="results/section4/miniread10_thresdhold300_drop0.9_smooth_pool1n2.png" width="280" alt="origin">
<img src="results/section4/miniread10_thresdhold300_drop0.9_nosmooth_pool1n2.png" width="280" alt="origin">

<p>
    set the <code>threshold</code> to be <b>500</b>:<br>
    The file information: ['results/tile_matrix_pool2_DJ_Hs_CM_0_K4me123_070122.bed.npz',
    'results/tile_matrix_DJ_Hs_CM_0_K4me123_070122.npz']<br>
    [filter] Kept 34320 / 57509 tiles (≥10 reads)<br>
    The information of the tile matrix : (47230, 34320)<br>
    The length of the total reads : 46052<br>
    The max of the reads : 28983<br>
    [cell filter] keeping 546 / 46052 cells (reads ≥ 500)<br>
    [drop = 0.90] kept 34320/34320 tiles; var_features→3431<br>
    [smooth] building KNN graph (k = 15)…<br>
    [smooth] aggregating values …<br>
    [drop = 0.90] kept 34320/34320 tiles; var_features→3431
</p>
<img src="results/section4/miniread10_thresdhold500_drop0.9_smooth_pool1n2.png" width="280" alt="origin">
<img src="results/section4/miniread10_thresdhold500_drop0.9_nosmooth_pool1n2.png" width="280" alt="origin">
